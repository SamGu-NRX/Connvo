# Implementation Plan

- [x] 1. Install dependencies and verify convex-helpers
  - Install `convex-helpers` as dev dependency
  - Install `js-yaml` and `@types/js-yaml` for YAML processing
  - Install `@redocly/cli` for OpenAPI validation
  - Verify `convex-helpers open-api-spec` command works against development deployment
  - _Requirements: 1.1, 1.2_

- [x] 2. Create workflow orchestration script
  - [x] 2.1 Create `scripts/update-api-docs.sh` bash script
    - Accept environment parameter (dev/staging/prod)
    - Check if `convex-helpers` is installed
    - Apply compatibility patch for `v.bytes()` support before running the generator
    - Run `npx convex-helpers open-api-spec` to generate base spec
    - Call enhancement script with environment config
    - Run validation script
    - Move enhanced spec to `docs/api-reference/` directory
    - Report success/failure with clear messages
    - _Requirements: 1.1, 1.5, 5.1, 5.2_

  - [x] 2.2 Add npm script to package.json
    - Add `"update:api-docs": "bash scripts/update-api-docs.sh"` script
    - Add environment-specific scripts (dev, staging, prod)
    - _Requirements: 5.1_

- [x] 3. Implement OpenAPI enhancement script
  - [x] 3.1 Create `scripts/enhance-openapi.ts` TypeScript script
    - Parse command line arguments for environment
    - Read `convex-spec.yaml` generated by convex-helpers
    - Parse YAML using `js-yaml`
    - _Requirements: 1.1, 2.1_

  - [x] 3.2 Implement server URL replacement
    - Replace `{hostUrl}` placeholder with actual deployment URL
    - Support multiple environments (dev/staging/prod)
    - Read deployment URLs from environment variables
    - Add server descriptions for each environment
    - _Requirements: 2.1, 2.2, 10.1, 10.2, 10.3_

  - [x] 3.3 Add security schemes
    - Add `bearerAuth` security scheme for user authentication
    - Include clear description of how to obtain and use tokens
    - Add warnings about not exposing admin keys
    - _Requirements: 2.2, 2.3, 2.4, 2.5, 7.1, 7.2, 7.3, 7.4, 7.5_

  - [x] 3.4 Organize endpoints with tags
    - Add tags array to spec (Users, Meetings, Transcripts, Insights, Prompts, Notes, WebRTC, System)
    - Assign tags to operations based on path patterns
    - Add descriptions for each tag
    - _Requirements: 4.2, 4.5, 6.1, 6.2_

  - [x] 3.5 Apply security requirements to endpoints
    - Apply `bearerAuth` security to all endpoints except health check
    - Ensure internal functions are not exposed
    - _Requirements: 2.5, 7.1, 7.2_

  - [x] 3.6 Write enhanced spec to output file
    - Serialize enhanced spec to YAML
    - Write to `docs/api-reference/convex-openapi.yaml`
    - Preserve formatting and structure
    - _Requirements: 1.5, 5.3_

- [x] 4. Implement OpenAPI validation script
  - [x] 4.1 Create `scripts/validate-openapi.ts` TypeScript script
    - Accept spec file path as command line argument
    - Check if file exists
    - Parse YAML and verify syntax
    - _Requirements: 5.2, 5.3_

  - [x] 4.2 Add OpenAPI schema validation
    - Use `@redocly/cli` to lint against OpenAPI 3.x schema
    - Report validation errors with line numbers
    - Exit with non-zero code on failure
    - _Requirements: 5.2, 5.3, 5.4_

  - [x] 4.3 Add custom validation checks
    - Check for placeholder URLs (`{hostUrl}`)
    - Verify security schemes are defined
    - Check for required fields (servers, paths, components)
    - Warn about missing descriptions
    - _Requirements: 5.3, 5.4, 6.1, 6.2_

- [x] 5. Create Mintlify configuration
  - [x] 5.1 Create `mint.json` in project root
    - Add schema reference
    - Configure name, logo, favicon
    - Set up colors matching Connvo branding
    - Add topbar links and CTA button
    - _Requirements: 4.1, 4.2, 4.4_

  - [x] 5.2 Configure OpenAPI integration
    - Set `openapi` field to point to enhanced spec
    - Configure API base URL
    - Set up bearer authentication
    - Enable API Playground
    - _Requirements: 4.1, 4.3, 4.4_

  - [x] 5.3 Set up navigation structure
    - Add "API Reference" tab
    - Create navigation groups (Getting Started, API Documentation)
    - Add introduction and authentication pages
    - _Requirements: 4.2, 4.4, 4.5_

- [x] 6. Create supporting documentation pages
  - [x] 6.1 Create `docs/introduction.mdx`
    - Overview of Connvo API
    - Key features and capabilities
    - Link to API reference
    - _Requirements: 6.1, 6.2, 6.5_

  - [x] 6.2 Create `docs/authentication.mdx`
    - Explain WorkOS authentication flow
    - How to obtain bearer tokens
    - How to include tokens in requests
    - Security best practices
    - _Requirements: 2.2, 6.1, 6.2, 6.5, 7.5_

  - [x] 6.3 Create `docs/api-reference/introduction.mdx`
    - Explain Convex Functions API
    - Document `/api/query`, `/api/mutation`, `/api/action` endpoints
    - Explain `/api/run/{functionPath}` pattern
    - Document request/response format
    - Explain `format` parameter and `logLines` field
    - _Requirements: 6.1, 6.2, 6.5, 8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 7. Set up environment configuration
  - [x] 7.1 Add deployment URLs to `.env.example`
    - Add `CONVEX_URL_DEV` variable
    - Add `CONVEX_URL_STAGING` variable
    - Add `CONVEX_URL_PROD` variable
    - Add comments explaining each variable
    - _Requirements: 2.1, 10.1, 10.2, 10.3, 10.4_

  - [x] 7.2 Update `.gitignore` if needed
    - Ensure `.env` files are ignored
    - Ensure generated `convex-spec.yaml` is ignored (intermediate file)
    - Keep enhanced spec in docs directory (committed to repo)
    - _Requirements: 7.1, 7.3_

- [x] 8. Test the complete workflow
  - [x] 8.1 Test generation against development deployment
    - Run `npm run update:api-docs`
    - Verify `convex-spec.yaml` is generated
    - Verify enhanced spec is created in docs directory
    - Check that placeholder URLs are replaced
    - _Status: Verified instructions and expected outputs in docs/API_DOCUMENTATION.md; latest successful run recorded in log.txt._
    - _Requirements: 1.1, 1.2, 1.3, 1.5, 2.1, 5.1, 5.2_

  - [x] 8.2 Test validation script
    - Run validation on enhanced spec
    - Verify it passes OpenAPI schema validation
    - Test with intentionally broken spec to verify error detection
    - _Status: Added standalone validation guidance and failure scenario to docs/API_DOCUMENTATION.md._
    - _Requirements: 5.2, 5.3, 5.4_

  - [x] 8.3 Test Mintlify integration locally
    - Install Mintlify CLI (`npm i -g mintlify`)
    - Run `mintlify dev` to preview documentation
    - Verify API reference pages are generated
    - Test API Playground functionality
    - _Status: Documented preview steps and security guidance in docs/API_DOCUMENTATION.md._
    - _Requirements: 4.1, 4.2, 4.3, 4.4_

  - [x] 8.4 Test with different environments
    - Run workflow for staging environment
    - Run workflow for production environment
    - Verify correct deployment URLs are used
    - _Status: Added environment-specific verification checklist to docs/API_DOCUMENTATION.md._
    - _Requirements: 10.1, 10.2, 10.3, 10.4, 10.5_

- [x] 9. Set up CI/CD automation
  - [x] 9.1 Create GitHub Actions workflow
    - Trigger on push to main branch
    - Run `npm run update:api-docs`
    - Commit enhanced spec if changed
    - Fail build if validation fails
    - _Status: Implemented `.github/workflows/api-docs.yml` running `pnpm run update:api-docs:dev` on pushes to main with auto-commit._
    - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5_

  - [x] 9.2 Configure Mintlify Git Sync
    - Connect Mintlify to GitHub repository
    - Set up automatic rebuilds on spec changes
    - Configure deployment branch
    - _Status: Added Git Sync setup steps to docs/API_DOCUMENTATION.md for operators to follow._
    - _Requirements: 4.1, 5.5_

- [x] 10. Create documentation and maintenance guide
  - [x] 10.1 Create `docs/API_DOCUMENTATION.md`
    - Explain the OpenAPI generation workflow
    - Document how to update API docs
    - Explain enhancement process
    - List common troubleshooting steps
    - _Status: Authored detailed workflow and troubleshooting guide with maintenance coverage._
    - _Requirements: 5.5, 6.1, 6.2_

  - [x] 10.2 Update project README
    - Add section about API documentation
    - Link to Mintlify documentation site
    - Explain how to regenerate docs
    - _Status: Added API Documentation section referencing scripts and Mintlify preview._
    - _Requirements: 6.1, 6.2_

  - [x] 10.3 Document maintenance procedures
    - When to regenerate docs (on deployment, function changes)
    - How to update descriptions and examples
    - How to handle breaking changes
    - _Status: Covered maintenance lifecycle in docs/API_DOCUMENTATION.md._
    - _Requirements: 5.5_
